---
title: 1.12 xformers
createTime: 2025/07/09 10:22:00
permalink: /experience/d3i72bs3/
---

我个人喜欢用 mamba（conda）创建环境，然后用 mamba 安装 pytorch + CUDA（如果需要使用 CUDA 编译），还有一些比如 gcc/g++ 等与 python 无关的一些工具。

但是最近我在扩充环境的时候，发现需要额外安装 xformers 这个库，这个库比较特殊，他需要与 pytorch、CUDA 版本相匹配

## 1.12.1 pip 安装

网上找了好多解法都是基于 pip 的：

在 [https://github.com/facebookresearch/xformers/tags](https://github.com/facebookresearch/xformers/tags) 中一个个查找到对应自己 pytorch 版本的 xformers 版本：

比如我现在使用的 PyTorch 2.1.2，其对应就是 v0.0.23.post1

<img src="https://raw.githubusercontent.com/PLUS-WAVE/blog-image/master/img/blog/2025-07-09/image-20250709162436965.png" alt="image-20250709162436965" style="zoom: 33%;" />

然后我使用的 CUDA 版本为 11.8，所以完整的命令就是：

```bash
pip install -U xformers==0.0.23.post1 --index-url https://download.pytorch.org/whl/cu118
```

## 1.12.2 Conda 安装

但是！**我使用的是 mamba 的 pytorch 配合 mamba 安装的 CUDA**；我如果要改 pytorch 为 pip 版本的，就会牵连到 CUDA 相关的库，很麻烦！

> 实验证明，pip 安装 pytorch 之后再用 `nvidia/label/cuda-xxx` channel 安装 CUDA 会出现 bug（自动安装最新版本的 CUDA）

如果我直接用 pip 安装 xformers 的话，会出现 pip 自动给你安装一个 pytorch，就会和 mamba 的 pytorch 打架了！

所以我需要用 mamba 安装 xformers，直接上最终解法：

```bash
mamba install pytorch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 pytorch-cuda=11.8 xformers -c pytorch -c nvidia/label/cuda-11.8.0 -c xformers
```

没错，就是直接在之前安装 pytorch 和 CUDA 的那个[1.2.3 里面的修改版本命令](/experience/a5k8sy7u/#_1-2-3-conda安装cuda-gcc)添加 `xformers` 和其对应的 channel `-c xformers`；==⚠️注意，一定要用 `xformers` channel！==

这样无论是从最开始安装，还是已经安装了 pytorch 之后再额外安装 xformers，都使用这个命令就可以啦！**他会自动找到合适你 python、pytorch 版本的 xformers 的！🥹**

已经安装了 pytorch 之后再额外安装 xformers情况下，命令执行结果：

<img src="https://raw.githubusercontent.com/PLUS-WAVE/blog-image/master/img/blog/2025-07-09/image-20250709162151228.png" alt="image-20250709162151228" style="zoom:50%;" />
